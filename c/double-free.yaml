rules:
  - id: raptor-double-free
    metadata:
      author: Farid
      cwe:
        - "CWE-415: Double Free"
      cwe_description: "Double free vulnerability occurs when the free() function is called more than once with the same memory address."
      confidence: MEDIUM
      # NOTE: C++ delete and delete[] operators are not covered.
      # NOTE: realloc() is not covered.
      # NOTE: Variations on the free() argument are not covered.
    message: >-
      The software calls free() twice on the same memory address, potentially 
      leading to memory corruption. This corruption can cause the program to 
      crash or cause two later calls to malloc() to return the same pointer.
    severity: ERROR
    languages:
      - c
      - cpp
    patterns:
      - pattern: |
          free($PTR);
          ...
          $FREE($PTR);
      - pattern-not: |
          free($PTR);
          ...
          $PTR = $EXPR;
          ...
          free($PTR);
      - metavariable-pattern:
          metavariable: $FREE
          pattern: free
      # improve output readability
      - focus-metavariable: $FREE
